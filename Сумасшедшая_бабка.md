# Задача о сумасшедшей старушке 

В этом тексте я расскажу об известной задаче, которую рассказывают даже школьникам, и её типично неверном решении. Я не в первый раз сталкиваюсь с тем, что это решение считается правильным и более того, в его неверности часто очень трудно убедить оппонентов, хотя казалось бы проблема с недоказанным логическим переходом на лицо.

## Условие

К самолету очередь из 100 пассажиров, у каждого билет на одно из 100 мест. Первой стоит сумасшедшая старушка. Она вбегает и садится на случайное место. Пассажиры по очереди занимают свои места. Если место занято – садятся на случайное. Найти вероятность того, что последний займет свое место

### [Стандартное решение](https://twitter.com/TrushinBV/status/1695349534786752690?s=20)

Решение задачи про сумасшедшую старушку. В конце могло остаться либо место старушки, либо место последнего пассажира. Для всех (включая саму старушку) эти места равноправны. Поэтому с равной вероятностью останется одно из них. Ответ: 50%



## Предисловие

Прежде всего я хочу сказать, что хоть по поводу этой задачи я абсолютно не согласен с Борисом Трушиным и буду критиковать его решение, это никоим образом не бросание камней в его огород. Высокая квалификация Бориса не вызывает сомнений и я всем рекомендую его ютуб-канал. Подобные разногласия и споры типичны для математиков и в заключении я приведу пример подобного случая.



## Разбор

Основная проблема в том, что никто не знает, что такое «равноправные места». Ниже я буду доказывать, что это заявление равносильно рассуждению «ответ 1/2, потому что задача симметрична»  без доказательства этой симметрии, а потому такое решение неполно и следовательно его нельзя считать верным. 

По ходу обсуждения такого решения постоянно возникают аргументы о том, почему места «равноправны», а такое решение верно, часто заканчивающиеся аргументом вида «всё тут очевидно». Прочность этого подхода состоит в том, что вместо формального утверждения и его доказательства происходит апелляция к интуиции, а при этом довольно часто возникают логические ошибки. 

Как всегда, если доказательство неверно, потому что содержит неверное утверждение, можно указать на ошибку. Если ошибка в доказательстве состоит в пропуске логических шагов, то на неверное утверждение указать невозможно, можно указать только на дыру в переходе; проблема обостряется из-за «очевидности» пропущенного логического шага. В качестве примера приведу «доказательство» основной теоремы арифметики, которая гласит, что любое положительное целое число больше 1 можно представить в виде произведения простых чисел единственным образом с точностью до перестановки множителей. Чаще всего, школьники и студенты, знакомясь с этой теоремой, говорят: «не, ну это очевидно, что же тут доказывать?!». В некоторых случаях могут привести «доказательство»: для простого числа утверждение верно по определению, а для составного будем просто раскладывать его на множители и по индукции получаем единственность представления. Это «доказательство» не содержит неверного утверждения, но содержит логические дыры в шаге индукции! Можете, например, посмотреть доказательство этой теоремы в ролике Бориса; у меня к этому доказательству была мелкая претензия, но в основном там всё коротко и ясно изложено.

Как же убедить человека в том, что в неполном доказательстве ошибка? Часто это очень сложно сделать, но также нередко бывают случаи, когда можно привести похожее утверждение, для которого справедливы все шаги «доказательства», но само это утверждение неверное. Так, в случае с основной теоремой арифметики, давайте рассмотрим похожее неверное утверждение, для которого проходит то же «доказательство». Предположим, что в нашем распоряжении есть только чётные числа и мы можем их умножать. Простыми числами, как и раньше, считаются числа, большие 1, которые нельзя представить в виде произведения других чисел. Посмотрим теперь на число 60: его можно разложить как $30*2$ и $6 * 10$! Легко видеть, что каждый из множителей является простым числом для этого множества, и аналог основной теоремы арифметики для него не выполняется. Однако, «доказательство» проходит и для этого случая, потому что никакие свойства множества положительных целых чисел не использует.

Вся эта длинная подводка была к тому, чтобы прояснить и оправдать жанр этого разбора. Сам разбор я решил написать, потому что долгие раздумья над необходимыми условиями симметрии задачи и анализ похожих задач привели к неожиданным для меня наблюдениям, которые, на мой взгляд, заслуживают внимания.

Начнём с формулировки и доказательсва следующей теоремы. 

**Теорема.** Пусть стоит очередь в самолёт. Все пассажиры, кроме последнего заходят в него и делают что угодно, но в результате этого процесса обязательно остаётся свободным ровно одно из $k$ фиксированных мест; формально задан произвольный набор вероятностей $p_i$ оставить свободным $i$-е место ($p_1 + \ldots + p_k = 1$). Последний пассажир получает случайно билет на одно из этих $k$ мест. Вероятность того, что это место свободно, равна $1/k$.

**Доказательство** этой теоремы тривиально: $i$-е место свободно с вероятностью $p_i$ и оно будет выбрано с вероятностью $1/k$, а потому искомая вероятность равна $p_1/k + \ldots + p_k/k = (p_1 + \ldots + p_k)/k = 1/k$. 

Если читатель знаком с вероятностью только на школьном уровне и считает, что это доказательство действительно очевидно, то у меня плохие новости, важные в рамках дискуссии об этой задачи: в доказательстве использована формула полной вероятности вместе с необходимыми для неё определениями условной вероятности и независимых событий, всё это в школьный курс не входит! Вообще, в школе не объясняется, в каких случаях формула $P[AB] = P[A]\cdot P[B]$ справедлива, а в каких нет!

Эта теорема нам потребовалась по ряду причин, первая из которых следующая. Часто при решении задачи о сумасшедшей бабки говорят «давайте считать, что мы случайным образом дали один из двух билетов бабке, а второй пассажиру, потому что действия всех пассажиров не зависят от этих мест». Потрясающее наблюдение состоит в том, что этот переход ошибочен! В случае симметричной задачи (с ответом 1/2 в случае двух пассажиров) это преобразование сохраняет ответ, а в случае несимметричной задачи, автоматически делает ответ 1/k у получившейся задачи!

Отсюда возникает вторая проблема с этой задачей: в условии часто не говорят, какие именно места у бабки и последнего пассажира, намекая на то, что это неважно. Может ли ответ зависеть от места, если процесс рассадки остальных пассажиров не зависит от номеров мест бабки и последнего пассажира и они не знают эти места? Да, может!

Мы приведём сразу несколько модификаций задач. Всюду в самолёт сначала заходят бабки, все пассажиры (кроме последнего) действуют по описанному в модификации алгоритму, а последний пассажир садится на своё место. При этом и бабка и все пассажиры кроме последнего не знают, какие места у бабки и последнего пассажира. Давайте ещё считать, что последний пассажир смотрит на своё место только когда зашёл в самолёт.

Первая модификация вырожденная: пусть есть только два пассажира — бабка и последний пассажир — и есть места с номерами 1 и 2. Бабка кидает монетку: выпал орёл — садится на первое место; выпала решка — кидает монету ещё раз: орёл — первое место, решка — второе. Очевидно, что ответ на вопрос задачи зависит от места пассажира! 

Подходит ли эта модификация под стандартное решение исходной задачи? Мы не знаем, потому что никто не знает, какие места «равноправны», а какие нет. Скептики скажут: «ну здесь процесс явно зависит от номеров мест, так не годится»! Хорошо, может ли кто-то перечислить от чего процесс должен зависеть, а от чего нет? Я в этом сомневаюсь, и причина моих сомнений кроется в следующей модификации.

В самолёте места поровну поделены на эконом и бизнес класс. Сначала заходят две сумасшедшие бабки и по очереди занимают случайное место (не смотря на класс). Дальше процесс устроен следующим образом: если место пассажира занято, то он занимает случайное место среди мест его класса, если такое есть; если нет — идёт в другой класс и занимает случайное место там. Вероятность пассажира занять своё место зависит от того, где расположены места бабок и его место. Если все места расположены в одном классе, то вероятность всегда 1/3. Если места бабок в разных классах, то с вероятностью 1/4 обе бабки пришли в один класс с пассажиром, и тогда он не займёт своё место; с вероятностью 1/4 обе бабки пришли в другой класс и тогда вероятность пассажира занять своё место равна 1/2; с вероятностью 1/2 бабки пришли в разные классы и вероятность пассажира занять своё место тоже 1/2 — итоговая вероятность 1/4+1/8. 

Таким образом, мы показали, что условие «равноправия мест» если и можно сформулировать, то оно нетривиально (и автору текста неизвестно). Попытки использовать в качестве аргументов какие-то свойства вероятностного пространства исходной задачи тоже сомнительны — без доказательства, что эти свойства влекут симметрию решение задачи нельзя считать верным в любом случае! А апелляция к очевидности этого следствия неуместна, как показывают примеры выше. Пример с «доказательством» основной теоремы арифметики ярко показывает, что пропуск «очевидных» свойств может привести к тому, что доказательством не является, а является в лучшем случае утверждением вида «исходное утверждение равносильно «очевидному» свойству», и часто такое свойство даже трудно сформулировать — попробуйте это сделать для «доказательства» основной теоремы арифметики!

## Заключение

Закончить я хочу курьёзным случаем — мне повезло слушать о нём доклад А. Шеня. «Теорему» о том, что для двух окружностей в общем случае невозможно построить их центры, используя только линейку, приписывали Гильберту. [Акопян и Фёдоров](https://arxiv.org/abs/1709.02562) нашли ошибку в известном доказательстве и привели бесконечно много примеров пар окружностей для которых такое построение возможно. Проблема крылась в том, что «интуитивно понятное» построение с помощью циркуля и линейки оказалось далеко не таким интуитивно понятным. Таким образом, почти век общественность скорее верила в «доказательство», которое было неверным, потому что никто не знал определений! При этом Акопян и Фёдоров построили свой пример не опираясь на формальное определение построения циркулем и линейкой (в котором и была основная проблема!), что возмутило А. Шеня, который вместе с А. Успенским написал [статью](https://arxiv.org/pdf/1805.12579.pdf) с детальным разбором построений с помощью циркуля и линейкой. На семинаре, на котором мне повезло присутствовать, как раз выяснилось, что некоторые известные московские математики использовали формальное определение построения циркулем и линейкой, которое оказалось неверным.

Из этого курьёзного случая видно, что даже профессиональные математики часто не достаточно заботятся о строгости доказательств и любят апеллировать к очевидности. На самом деле многим работающим математикам в их деятельности это просто не нужно. Тем труднее выявить проблему с опущенными из-за очевидностей логическими шагами, когда они возникают.
